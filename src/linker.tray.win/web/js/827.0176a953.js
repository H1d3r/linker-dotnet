"use strict";(self["webpackChunklinker_web"]=self["webpackChunklinker_web"]||[]).push([[827],{8827:function(e,l,a){a.d(l,{A:function(){return X}});var t=a(6768),o=a(4232);const r=e=>((0,t.Qi)("data-v-0679a99a"),e=e(),(0,t.jt)(),e),d={class:"head"},s={class:"flex"},n={class:"flex mgt-1"},i={class:"flex mgt-1"},c={class:"mgl-1"},u={class:"mgl-1"},m=r((()=>(0,t.Lk)("div",{class:"flex-1"},null,-1))),b={class:"body flex-1 relative"},h=["title"],p=["title"],f={class:"flex"},v=["onClick"],w={href:"javascript:void(0);",class:"a-line"};function k(e,l,a,r,k,D){const F=(0,t.g2)("el-option"),g=(0,t.g2)("el-select"),V=(0,t.g2)("el-input"),_=(0,t.g2)("el-button"),C=(0,t.g2)("el-table-column"),I=(0,t.g2)("el-switch"),S=(0,t.g2)("el-popconfirm"),$=(0,t.g2)("el-table"),y=(0,t.g2)("Add");return(0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.Lk)("div",d,[(0,t.Lk)("div",s,[(0,t.Lk)("div",n,[(0,t.Lk)("div",null,[(0,t.bF)(g,{modelValue:r.state.search.Data.Action,"onUpdate:modelValue":l[0]||(l[0]=e=>r.state.search.Data.Action=e),onChange:r.loadData,size:"small",class:"mgr-1",style:{width:"9rem"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.actions,((e,l)=>((0,t.uX)(),(0,t.Wv)(F,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue","onChange"])]),(0,t.Lk)("div",null,[(0,t.bF)(g,{modelValue:r.state.search.Data.Protocol,"onUpdate:modelValue":l[1]||(l[1]=e=>r.state.search.Data.Protocol=e),onChange:r.loadData,size:"small",class:"mgr-1",style:{width:"9rem"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.protocols,((e,l)=>((0,t.uX)(),(0,t.Wv)(F,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue","onChange"])]),(0,t.Lk)("div",null,[(0,t.bF)(g,{modelValue:r.state.search.Data.Disabled,"onUpdate:modelValue":l[2]||(l[2]=e=>r.state.search.Data.Disabled=e),onChange:r.loadData,size:"small",class:"mgr-1",style:{width:"9rem"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.states,((e,l)=>((0,t.uX)(),(0,t.Wv)(F,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue","onChange"])])]),(0,t.Lk)("div",i,[(0,t.Lk)("div",null,[(0,t.Lk)("span",null,(0,o.v_)(e.$t("firewall.srcName"))+"/"+(0,o.v_)(e.$t("firewall.dstCidr"))+"/"+(0,o.v_)(e.$t("firewall.dstPort"))+"/"+(0,o.v_)(e.$t("firewall.remark")),1),(0,t.bF)(V,{modelValue:r.state.search.Data.Str,"onUpdate:modelValue":l[3]||(l[3]=e=>r.state.search.Data.Str=e),onChange:r.loadData,size:"small",style:{width:"7rem"}},null,8,["modelValue","onChange"])]),(0,t.Lk)("div",c,[(0,t.bF)(_,{size:"small",loading:r.state.loading,onClick:r.loadData},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("common.refresh")),1)])),_:1},8,["loading","onClick"])]),(0,t.Lk)("div",u,[(0,t.bF)(_,{type:"success",size:"small",loading:r.state.loading,onClick:l[4]||(l[4]=e=>r.handleAdd())},{default:(0,t.k6)((()=>[(0,t.eW)("+")])),_:1},8,["loading"])])]),m])]),(0,t.Lk)("div",b,[(0,t.bF)($,{class:"firewall",stripe:"",border:"",data:r.state.data,size:"small",height:`${r.state.height}px`,"row-class-name":r.tableRowClassName},{default:(0,t.k6)((()=>[(0,t.bF)(C,{prop:"SrcName",label:e.$t("firewall.srcName")},{default:(0,t.k6)((e=>[(0,t.Lk)("div",{class:"ellipsis",title:e.row.SrcName},(0,o.v_)(e.row.SrcName),9,h)])),_:1},8,["label"]),(0,t.bF)(C,{prop:"DstCIDR",label:e.$t("firewall.dstCidr"),width:"130"},null,8,["label"]),(0,t.bF)(C,{prop:"DstPort",label:e.$t("firewall.dstPort")},null,8,["label"]),(0,t.bF)(C,{prop:"Protocol",label:e.$t("firewall.protocol"),width:"70"},{default:(0,t.k6)((e=>[(0,t.eW)((0,o.v_)(r.handleShowProtocol(e.row.Protocol)),1)])),_:1},8,["label"]),(0,t.bF)(C,{prop:"Action",label:e.$t("firewall.action"),width:"50"},{default:(0,t.k6)((e=>[(0,t.eW)((0,o.v_)(r.handleShowAction(e.row.Action)),1)])),_:1},8,["label"]),(0,t.bF)(C,{prop:"OrderBy",label:e.$t("firewall.orderby"),width:"60"},null,8,["label"]),(0,t.bF)(C,{prop:"Disabled",label:e.$t("firewall.disabled"),width:"70"},{default:(0,t.k6)((e=>[(0,t.Lk)("div",null,[(0,t.bF)(I,{modelValue:e.row.Disabled,"onUpdate:modelValue":l=>e.row.Disabled=l,size:"small","active-text":"😀","inactive-text":"😣","inline-prompt":"",onChange:l=>r.handleDsiabled(e.row),style:{"--el-switch-on-color":"red"}},null,8,["modelValue","onUpdate:modelValue","onChange"])])])),_:1},8,["label"]),(0,t.bF)(C,{prop:"Remark",label:e.$t("firewall.remark")},{default:(0,t.k6)((e=>[(0,t.Lk)("div",{class:"ellipsis",title:e.row.Remark},(0,o.v_)(e.row.Remark),9,p)])),_:1},8,["label"]),(0,t.bF)(C,{width:"80",fixed:"right"},{header:(0,t.k6)((()=>[(0,t.Lk)("div",f,[(0,t.bF)(I,{modelValue:r.state.state,"onUpdate:modelValue":l[5]||(l[5]=e=>r.state.state=e),size:"small",title:e.$t("firewall.switch"),"active-value":0,"inactive-value":1,"active-text":"😀","inactive-text":"😣","inline-prompt":"",onChange:r.handleSetState},null,8,["modelValue","title","onChange"])])])),default:(0,t.k6)((l=>[(0,t.Lk)("div",null,[(0,t.Lk)("a",{href:"javascript:void(0);",class:"a-line mgr-1",onClick:e=>r.handleAdd(l.row)},(0,o.v_)(e.$t("firewall.edit")),9,v),(0,t.bF)(S,{"confirm-button-text":e.$t("common.confirm"),"cancel-button-text":e.$t("common.cancel"),title:e.$t("firewall.delConfirm"),onConfirm:e=>r.handleDel(l.row)},{reference:(0,t.k6)((()=>[(0,t.Lk)("a",w,(0,o.v_)(e.$t("firewall.del")),1)])),_:2},1032,["confirm-button-text","cancel-button-text","title","onConfirm"])])])),_:1})])),_:1},8,["data","height","row-class-name"])]),r.state.showAdd?((0,t.uX)(),(0,t.Wv)(y,{key:0,modelValue:r.state.showAdd,"onUpdate:modelValue":l[6]||(l[6]=e=>r.state.showAdd=e),onSuccess:r.loadData},null,8,["modelValue","onSuccess"])):(0,t.Q3)("",!0)],64)}var D=a(144),F=a(3830),g=a(4);const V=e=>(0,g.zG)("firewall/get",e),_=e=>(0,g.zG)("firewall/add",e),C=e=>(0,g.zG)("firewall/remove",e),I=e=>(0,g.zG)("firewall/state",e);var S=a(5931),$=a(1219);const y={class:"flex"},A={class:"t-c w-100"},N={class:"t-c w-100 mgt-1"};function P(e,l,a,r,d,s){const n=(0,t.g2)("el-input"),i=(0,t.g2)("el-form-item"),c=(0,t.g2)("el-col"),u=(0,t.g2)("el-row"),m=(0,t.g2)("el-option"),b=(0,t.g2)("el-select"),h=(0,t.g2)("el-input-number"),p=(0,t.g2)("el-switch"),f=(0,t.g2)("el-button"),v=(0,t.g2)("el-form"),w=(0,t.g2)("el-dialog"),k=(0,t.g2)("el-transfer");return(0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.bF)(w,{class:"options-center",title:e.$t("firewall.rule"),"destroy-on-close":"",modelValue:r.state.show,"onUpdate:modelValue":l[9]||(l[9]=e=>r.state.show=e),width:"50rem",top:"2vh"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",null,[(0,t.bF)(v,{ref:"ruleFormRef",model:r.state.ruleForm.Data,rules:r.state.rules,"label-width":"auto"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{label:e.$t("firewall.srcName"),prop:"SrcId"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{type:"textarea",modelValue:r.state.ruleForm.Data.SrcName,"onUpdate:modelValue":l[0]||(l[0]=e=>r.state.ruleForm.Data.SrcName=e),onClick:r.handleSrcId,readonly:"",resize:"none",rows:"2"},null,8,["modelValue","onClick"])])),_:1},8,["label"]),(0,t.bF)(i),(0,t.bF)(i,{label:e.$t("firewall.dstCidr"),prop:"DstCIDR"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{class:"w-100"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:r.state.ruleForm.Data.DstCIDR,"onUpdate:modelValue":l[1]||(l[1]=e=>r.state.ruleForm.Data.DstCIDR=e)},null,8,["modelValue"])])),_:1}),(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.eW)(" 10.18.1.1/24、10.18.1.1、0、* ")])),_:1})])),_:1})])),_:1},8,["label"]),(0,t.bF)(i,{label:e.$t("firewall.dstPort"),prop:"DstPort"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{class:"w-100"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:r.state.ruleForm.Data.DstPort,"onUpdate:modelValue":l[2]||(l[2]=e=>r.state.ruleForm.Data.DstPort=e)},null,8,["modelValue"])])),_:1}),(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.eW)(" 80、80-88、80,443、0、* ")])),_:1})])),_:1})])),_:1},8,["label"]),(0,t.bF)(i,{label:e.$t("firewall.protocol"),prop:"Protocol"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{class:"w-100"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(b,{modelValue:r.state.protocolChecks,"onUpdate:modelValue":l[3]||(l[3]=e=>r.state.protocolChecks=e),multiple:""},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.protocols,((e,l)=>((0,t.uX)(),(0,t.Wv)(m,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(c,{span:12})])),_:1})])),_:1},8,["label"]),(0,t.bF)(i,{label:e.$t("firewall.action"),prop:"Action"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{class:"w-100"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(b,{modelValue:r.state.ruleForm.Data.Action,"onUpdate:modelValue":l[4]||(l[4]=e=>r.state.ruleForm.Data.Action=e)},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.actions,((e,l)=>((0,t.uX)(),(0,t.Wv)(m,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(c,{span:12})])),_:1})])),_:1},8,["label"]),(0,t.bF)(i),(0,t.bF)(i,{label:e.$t("firewall.orderby"),prop:"OrderBy"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:r.state.ruleForm.Data.OrderBy,"onUpdate:modelValue":l[5]||(l[5]=e=>r.state.ruleForm.Data.OrderBy=e),min:0,max:65535,style:{width:"13rem"}},null,8,["modelValue"])])),_:1},8,["label"]),(0,t.bF)(i,{label:e.$t("firewall.disabled"),prop:"Disabled"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",y,[(0,t.bF)(p,{modelValue:r.state.ruleForm.Data.Disabled,"onUpdate:modelValue":l[6]||(l[6]=e=>r.state.ruleForm.Data.Disabled=e),"active-text":"😀","inactive-text":"😣","inline-prompt":""},null,8,["modelValue"])])])),_:1},8,["label"]),(0,t.bF)(i,{label:e.$t("firewall.remark"),prop:"Remark"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{modelValue:r.state.ruleForm.Data.Remark,"onUpdate:modelValue":l[7]||(l[7]=e=>r.state.ruleForm.Data.Remark=e)},null,8,["modelValue"])])),_:1},8,["label"]),(0,t.bF)(i,{label:"",prop:"Btns"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",A,[(0,t.bF)(f,{onClick:l[8]||(l[8]=e=>r.state.show=!1)},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("common.cancel")),1)])),_:1}),(0,t.bF)(f,{type:"primary",onClick:r.handleSave},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("common.confirm")),1)])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["title","modelValue"]),(0,t.bF)(w,{class:"options-center",title:e.$t("firewall.srcName"),"destroy-on-close":"",modelValue:r.state.showSrcName,"onUpdate:modelValue":l[12]||(l[12]=e=>r.state.showSrcName=e),width:"54rem",top:"2vh"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",null,[(0,t.bF)(k,{class:"src-tranfer",modelValue:r.state.srcIdValues,"onUpdate:modelValue":l[10]||(l[10]=e=>r.state.srcIdValues=e),filterable:"","filter-method":r.srcFilterMethod,data:r.state.srcIds,titles:[e.$t("firewall.unselect"),e.$t("firewall.selected")],props:{key:"MachineId",label:"MachineName"}},null,8,["modelValue","filter-method","data","titles"]),(0,t.Lk)("div",N,[(0,t.bF)(f,{onClick:l[11]||(l[11]=e=>r.state.showSrcName=!1)},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("common.cancel")),1)])),_:1}),(0,t.bF)(f,{type:"primary",onClick:r.handleSrcName},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("common.confirm")),1)])),_:1},8,["onClick"])])])])),_:1},8,["title","modelValue"])],64)}var L=a(9299),R={props:["modelValue"],emits:["update:modelValue","success"],setup(e,{emit:l}){const{t:a}=(0,S.s9)(),o=(0,t.WQ)("add"),r=(0,D.Kh)({show:!0,loading:!1,protocolChecks:[1&o.value.Data.Protocol,2&o.value.Data.Protocol].filter((e=>e>0)),ruleForm:{MachineId:o.value.MachineId,Data:{Id:o.value.Data.Id,GroupId:o.value.Data.GroupId,SrcName:o.value.Data.SrcName,Disabled:o.value.Data.Disabled,OrderBy:o.value.Data.OrderBy,SrcId:o.value.Data.SrcId,DstCIDR:o.value.Data.DstCIDR,DstPort:o.value.Data.DstPort,Protocol:o.value.Data.Protocol,Action:o.value.Data.Action,Remark:o.value.Data.Remark}},rules:{SrcId:[{required:!0,message:"required",trigger:"blur"}],DstCIDR:[{type:"string",required:!0,message:"required",trigger:"blur",pattern:/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}(\/([0-9]|([1-2][0-9])|(3[0-2])))?)$|^0$|^\*$/}],DstPort:[{type:"string",required:!0,message:"required",trigger:"blur",pattern:/^((\d+)(?:,(\d+))*)$|^((\d+)(?:\-(\d+))*)$|^0$|^\*$/}]},protocols:[{label:"TCP",value:1},{label:"UDP",value:2}],actions:[{label:a("firewall.actionAllow"),value:1},{label:a("firewall.actionDeny"),value:2}],srcIds:[],srcIdValues:[],showSrcName:!1});(0,t.wB)((()=>r.show),(e=>{e||setTimeout((()=>{l("update:modelValue",e)}),300)}));const d=(0,D.KR)(null),s=()=>{d.value.validate((e=>{if(!e)return;const t=JSON.parse(JSON.stringify(r.ruleForm));t.Data.Protocol=r.protocolChecks.reduce(((e,l)=>e|l),0),_(t).then((()=>{$.nk.success(a("common.oper")),r.show=!1,l("success")})).catch((()=>{$.nk.error(a("common.operFail"))}))}))},n=()=>{r.srcIdValues=r.ruleForm.Data.SrcId.split(",").filter((e=>e)),r.showSrcName=!0},i=()=>{r.ruleForm.Data.SrcId=r.srcIdValues.join(","),r.ruleForm.Data.SrcName=r.srcIds.filter((e=>r.srcIdValues.includes(e.MachineId))).map((e=>e.MachineName)).join(","),r.showSrcName=!1},c=()=>{r.loading=!0,(0,L.NT)().then((e=>{r.loading=!1,e.splice(0,0,{MachineId:"*",MachineName:"*"}),r.srcIds=e})).catch((e=>{r.loading=!1}))},u=(e,l)=>l.MachineName.toLowerCase().includes(e.toLowerCase());return(0,t.sV)((()=>{c()})),{state:r,ruleFormRef:d,handleSave:s,srcFilterMethod:u,handleSrcId:n,handleSrcName:i}}},x=a(1241);const U=(0,x.A)(R,[["render",P],["__scopeId","data-v-6c157ed4"]]);var M=U,W={props:["machineId","machineName"],components:{Add:M},setup(e,{emit:l}){const{t:a}=(0,S.s9)(),o=(0,F.B)(),r=(0,D.Kh)({loading:!0,search:{MachineId:e.machineId||o.value.config.Client.Id,Data:{Str:"",Disabled:-1,Protocol:3,Action:3}},protocols:[{label:a("firewall.protocolall"),value:3},{label:"TCP",value:1},{label:"UDP",value:2}],actions:[{label:a("firewall.actionall"),value:3},{label:a("firewall.actionAllow"),value:1},{label:a("firewall.actionDeny"),value:2}],states:[{label:a("firewall.disabledAll"),value:-1},{label:a("firewall.enabled"),value:0},{label:a("firewall.disabled"),value:1}],data:[],state:1,height:(0,D.EW)((()=>o.value.height-140)),showAdd:!1}),d=()=>{r.loading=!0,V(r.search).then((e=>{r.loading=!1,r.data=e.List,r.state=e.State})).catch((e=>{console.log(e),r.loading=!1}))},s=()=>{r.loading=!0,I({MachineId:r.search.MachineId,State:r.state}).then((()=>{r.loading=!1,$.nk.success(a("common.oper"))})).catch((e=>{r.loading=!1,console.log(e),$.nk.error(a("common.operFail"))}))},n=e=>{r.loading=!0,C({MachineId:r.search.MachineId,Id:e.Id}).then((()=>{d(),r.loading=!1})).catch((()=>{r.loading=!1}))},i=e=>{r.loading=!0,_({MachineId:r.search.MachineId,Data:e}).then((()=>{d(),r.loading=!1})).catch((()=>{r.loading=!1}))},c=(0,D.KR)({});(0,t.Gt)("add",c);const u=e=>{c.value={MachineId:r.search.MachineId,Data:e||{Id:"",GroupId:o.value.config.Client.Group.Id,SrcName:"",Disabled:!1,OrderBy:0,SrcId:"",DstCIDR:"0.0.0.0/0",DstPort:"0",Protocol:3,Action:1,Remark:a("firewall.actionAllowAll")}},r.showAdd=!0},m=["","TCP","UDP"],b=e=>[m[1&e],m[2&e]].filter((e=>!!e)).join("/"),h=["","✔","✘"],p=e=>h[e],f=({row:e,rowIndex:l})=>`action-${e.Action}`;return(0,t.sV)((()=>{d()})),{state:r,loadData:d,tableRowClassName:f,handleSetState:s,handleAdd:u,handleDel:n,handleShowProtocol:b,handleShowAction:p,handleDsiabled:i}}};const z=(0,x.A)(W,[["render",k],["__scopeId","data-v-0679a99a"]]);var X=z}}]);