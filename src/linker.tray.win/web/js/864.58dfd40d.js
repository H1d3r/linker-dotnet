"use strict";(self["webpackChunklinker_web"]=self["webpackChunklinker_web"]||[]).push([[864],{9864:function(e,a,l){l.d(a,{A:function(){return z}});var t=l(6768),o=l(4232);const r=e=>((0,t.Qi)("data-v-3294acdd"),e=e(),(0,t.jt)(),e),d={class:"head"},n={class:"flex"},s={class:"mgl-1"},i={class:"mgl-1"},u=r((()=>(0,t.Lk)("div",{class:"flex-1"},null,-1))),c={class:"body flex-1 relative"},m=["title"],h=["title"],b={class:"flex"},p=["onClick"],v={href:"javascript:void(0);",class:"a-line"};function f(e,a,l,r,f,g){const w=(0,t.g2)("el-option"),k=(0,t.g2)("el-select"),D=(0,t.g2)("el-input"),F=(0,t.g2)("el-button"),I=(0,t.g2)("el-table-column"),C=(0,t.g2)("el-switch"),_=(0,t.g2)("el-popconfirm"),V=(0,t.g2)("el-table"),S=(0,t.g2)("Add");return(0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.Lk)("div",d,[(0,t.Lk)("div",n,[(0,t.Lk)("div",null,[(0,t.bF)(k,{modelValue:r.state.search.Data.Action,"onUpdate:modelValue":a[0]||(a[0]=e=>r.state.search.Data.Action=e),onChange:r.loadData,size:"small",class:"mgr-1",style:{width:"9rem"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.actions,((e,a)=>((0,t.uX)(),(0,t.Wv)(w,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue","onChange"])]),(0,t.Lk)("div",null,[(0,t.bF)(k,{modelValue:r.state.search.Data.Protocol,"onUpdate:modelValue":a[1]||(a[1]=e=>r.state.search.Data.Protocol=e),onChange:r.loadData,size:"small",class:"mgr-1",style:{width:"9rem"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.protocols,((e,a)=>((0,t.uX)(),(0,t.Wv)(w,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue","onChange"])]),(0,t.Lk)("div",null,[(0,t.bF)(k,{modelValue:r.state.search.Data.Disabled,"onUpdate:modelValue":a[2]||(a[2]=e=>r.state.search.Data.Disabled=e),onChange:r.loadData,size:"small",class:"mgr-1",style:{width:"9rem"}},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.states,((e,a)=>((0,t.uX)(),(0,t.Wv)(w,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue","onChange"])]),(0,t.Lk)("div",null,[(0,t.Lk)("span",null,(0,o.v_)(e.$t("firewall.srcName"))+"/"+(0,o.v_)(e.$t("firewall.dstCidr"))+"/"+(0,o.v_)(e.$t("firewall.dstPort"))+"/"+(0,o.v_)(e.$t("firewall.remark")),1),(0,t.bF)(D,{modelValue:r.state.search.Data.Str,"onUpdate:modelValue":a[3]||(a[3]=e=>r.state.search.Data.Str=e),onChange:r.loadData,size:"small",style:{width:"7rem"}},null,8,["modelValue","onChange"])]),(0,t.Lk)("div",s,[(0,t.bF)(F,{size:"small",loading:r.state.loading,onClick:r.loadData},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("common.refresh")),1)])),_:1},8,["loading","onClick"])]),(0,t.Lk)("div",i,[(0,t.bF)(F,{type:"success",size:"small",loading:r.state.loading,onClick:a[4]||(a[4]=e=>r.handleAdd())},{default:(0,t.k6)((()=>[(0,t.eW)("+")])),_:1},8,["loading"])]),u])]),(0,t.Lk)("div",c,[(0,t.bF)(V,{class:"firewall",stripe:"",border:"",data:r.state.data,size:"small",height:`${r.state.height}px`,width:"100%","row-class-name":r.tableRowClassName},{default:(0,t.k6)((()=>[(0,t.bF)(I,{prop:"SrcName",label:e.$t("firewall.srcName")},{default:(0,t.k6)((e=>[(0,t.Lk)("div",{class:"ellipsis",title:e.row.SrcName},(0,o.v_)(e.row.SrcName),9,m)])),_:1},8,["label"]),(0,t.bF)(I,{prop:"DstCIDR",label:e.$t("firewall.dstCidr"),width:"130"},null,8,["label"]),(0,t.bF)(I,{prop:"DstPort",label:e.$t("firewall.dstPort")},null,8,["label"]),(0,t.bF)(I,{prop:"Protocol",label:e.$t("firewall.protocol"),width:"70"},{default:(0,t.k6)((e=>[(0,t.eW)((0,o.v_)(r.handleShowProtocol(e.row.Protocol)),1)])),_:1},8,["label"]),(0,t.bF)(I,{prop:"Action",label:e.$t("firewall.action"),width:"50"},{default:(0,t.k6)((e=>[(0,t.eW)((0,o.v_)(r.handleShowAction(e.row.Action)),1)])),_:1},8,["label"]),(0,t.bF)(I,{prop:"OrderBy",label:e.$t("firewall.orderby"),width:"60"},null,8,["label"]),(0,t.bF)(I,{prop:"Disabled",label:e.$t("firewall.disabled"),width:"70"},{default:(0,t.k6)((e=>[(0,t.Lk)("div",null,[(0,t.bF)(C,{modelValue:e.row.Disabled,"onUpdate:modelValue":a=>e.row.Disabled=a,size:"small","active-text":"😀","inactive-text":"😣","inline-prompt":"",onChange:a=>r.handleDsiabled(e.row),style:{"--el-switch-on-color":"red"}},null,8,["modelValue","onUpdate:modelValue","onChange"])])])),_:1},8,["label"]),(0,t.bF)(I,{prop:"Remark",label:e.$t("firewall.remark")},{default:(0,t.k6)((e=>[(0,t.Lk)("div",{class:"ellipsis",title:e.row.Remark},(0,o.v_)(e.row.Remark),9,h)])),_:1},8,["label"]),(0,t.bF)(I,{width:"80",fixed:"right"},{header:(0,t.k6)((()=>[(0,t.Lk)("div",b,[(0,t.bF)(C,{modelValue:r.state.state,"onUpdate:modelValue":a[5]||(a[5]=e=>r.state.state=e),size:"small",title:e.$t("firewall.switch"),"active-value":0,"inactive-value":1,"active-text":"😀","inactive-text":"😣","inline-prompt":"",onChange:r.handleSetState},null,8,["modelValue","title","onChange"])])])),default:(0,t.k6)((a=>[(0,t.Lk)("div",null,[(0,t.Lk)("a",{href:"javascript:void(0);",class:"a-line mgr-1",onClick:e=>r.handleAdd(a.row)},(0,o.v_)(e.$t("firewall.edit")),9,p),(0,t.bF)(_,{"confirm-button-text":e.$t("common.confirm"),"cancel-button-text":e.$t("common.cancel"),title:e.$t("firewall.delConfirm"),onConfirm:e=>r.handleDel(a.row)},{reference:(0,t.k6)((()=>[(0,t.Lk)("a",v,(0,o.v_)(e.$t("firewall.del")),1)])),_:2},1032,["confirm-button-text","cancel-button-text","title","onConfirm"])])])),_:1})])),_:1},8,["data","height","row-class-name"])]),r.state.showAdd?((0,t.uX)(),(0,t.Wv)(S,{key:0,modelValue:r.state.showAdd,"onUpdate:modelValue":a[6]||(a[6]=e=>r.state.showAdd=e),onSuccess:r.loadData},null,8,["modelValue","onSuccess"])):(0,t.Q3)("",!0)],64)}var g=l(144),w=l(3830),k=l(4);const D=e=>(0,k.zG)("firewall/get",e),F=e=>(0,k.zG)("firewall/add",e),I=e=>(0,k.zG)("firewall/remove",e),C=e=>(0,k.zG)("firewall/state",e);var _=l(5931),V=l(1219);const S={class:"t-c"},$={class:"page-wrap"},P={class:"flex"},A={class:"t-c w-100"};function L(e,a,l,r,d,n){const s=(0,t.g2)("el-pagination"),i=(0,t.g2)("el-option"),u=(0,t.g2)("el-select"),c=(0,t.g2)("el-col"),m=(0,t.g2)("el-row"),h=(0,t.g2)("el-form-item"),b=(0,t.g2)("el-input"),p=(0,t.g2)("el-input-number"),v=(0,t.g2)("el-switch"),f=(0,t.g2)("el-button"),g=(0,t.g2)("el-form"),w=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.Wv)(w,{class:"options-center",title:e.$t("firewall.rule"),"destroy-on-close":"",modelValue:r.state.show,"onUpdate:modelValue":a[10]||(a[10]=e=>r.state.show=e),width:"50rem",top:"2vh"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",null,[(0,t.bF)(g,{ref:"ruleFormRef",model:r.state.ruleForm.Data,rules:r.state.rules,"label-width":"auto"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{label:e.$t("firewall.srcName"),prop:"SrcId"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{class:"w-100"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:r.state.ruleForm.Data.SrcId,"onUpdate:modelValue":a[0]||(a[0]=e=>r.state.ruleForm.Data.SrcId=e),onChange:a[1]||(a[1]=e=>r.handleMachineChange()),filterable:"",remote:"",loading:r.state.loading,"remote-method":r.handleMachineSearch},{header:(0,t.k6)((()=>[(0,t.Lk)("div",S,[(0,t.Lk)("div",$,[(0,t.bF)(s,{small:"",background:"",layout:"prev, pager, next","page-size":r.state.machineIds.Request.Size,total:r.state.machineIds.Count,"pager-count":5,"current-page":r.state.machineIds.Request.Page,onCurrentChange:r.handleMachinePageChange},null,8,["page-size","total","current-page","onCurrentChange"])])])])),default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.machineIds.List,((e,a)=>((0,t.uX)(),(0,t.Wv)(i,{key:a,label:e.MachineName,value:e.MachineId},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading","remote-method"])])),_:1}),(0,t.bF)(c,{span:12})])),_:1})])),_:1},8,["label"]),(0,t.bF)(h),(0,t.bF)(h,{label:e.$t("firewall.dstCidr"),prop:"DstCIDR"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{class:"w-100"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(b,{modelValue:r.state.ruleForm.Data.DstCIDR,"onUpdate:modelValue":a[2]||(a[2]=e=>r.state.ruleForm.Data.DstCIDR=e)},null,8,["modelValue"])])),_:1}),(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.eW)(" 10.18.1.1/24、10.18.1.1、0、* ")])),_:1})])),_:1})])),_:1},8,["label"]),(0,t.bF)(h,{label:e.$t("firewall.dstPort"),prop:"DstPort"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{class:"w-100"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(b,{modelValue:r.state.ruleForm.Data.DstPort,"onUpdate:modelValue":a[3]||(a[3]=e=>r.state.ruleForm.Data.DstPort=e)},null,8,["modelValue"])])),_:1}),(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.eW)(" 80、80-88、80,443、0、* ")])),_:1})])),_:1})])),_:1},8,["label"]),(0,t.bF)(h,{label:e.$t("firewall.protocol"),prop:"Protocol"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{class:"w-100"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:r.state.protocolChecks,"onUpdate:modelValue":a[4]||(a[4]=e=>r.state.protocolChecks=e),multiple:""},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.protocols,((e,a)=>((0,t.uX)(),(0,t.Wv)(i,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(c,{span:12})])),_:1})])),_:1},8,["label"]),(0,t.bF)(h,{label:e.$t("firewall.action"),prop:"Action"},{default:(0,t.k6)((()=>[(0,t.bF)(m,{class:"w-100"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{span:12},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:r.state.ruleForm.Data.Action,"onUpdate:modelValue":a[5]||(a[5]=e=>r.state.ruleForm.Data.Action=e)},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(r.state.actions,((e,a)=>((0,t.uX)(),(0,t.Wv)(i,{value:e.value,label:e.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(c,{span:12})])),_:1})])),_:1},8,["label"]),(0,t.bF)(h),(0,t.bF)(h,{label:e.$t("firewall.orderby"),prop:"OrderBy"},{default:(0,t.k6)((()=>[(0,t.bF)(p,{modelValue:r.state.ruleForm.Data.OrderBy,"onUpdate:modelValue":a[6]||(a[6]=e=>r.state.ruleForm.Data.OrderBy=e),min:0,max:65535,style:{width:"13rem"}},null,8,["modelValue"])])),_:1},8,["label"]),(0,t.bF)(h,{label:e.$t("firewall.disabled"),prop:"Disabled"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",P,[(0,t.bF)(v,{modelValue:r.state.ruleForm.Data.Disabled,"onUpdate:modelValue":a[7]||(a[7]=e=>r.state.ruleForm.Data.Disabled=e),"active-text":"😀","inactive-text":"😣","inline-prompt":""},null,8,["modelValue"])])])),_:1},8,["label"]),(0,t.bF)(h,{label:e.$t("firewall.remark"),prop:"Remark"},{default:(0,t.k6)((()=>[(0,t.bF)(b,{modelValue:r.state.ruleForm.Data.Remark,"onUpdate:modelValue":a[8]||(a[8]=e=>r.state.ruleForm.Data.Remark=e)},null,8,["modelValue"])])),_:1},8,["label"]),(0,t.bF)(h,{label:"",prop:"Btns"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",A,[(0,t.bF)(f,{onClick:a[9]||(a[9]=e=>r.state.show=!1)},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("common.cancel")),1)])),_:1}),(0,t.bF)(f,{type:"primary",onClick:r.handleSave},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("common.confirm")),1)])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["title","modelValue"])}var R=l(9299),y={props:["modelValue"],emits:["update:modelValue","success"],setup(e,{emit:a}){const{t:l}=(0,_.s9)(),o=(0,t.WQ)("add"),r=(0,g.Kh)({show:!0,loading:!1,machineIds:{Request:{Page:1,Size:10,Name:""},Count:0,List:[]},protocolChecks:[1&o.value.Data.Protocol,2&o.value.Data.Protocol].filter((e=>e>0)),ruleForm:{MachineId:o.value.MachineId,Data:{Id:o.value.Data.Id,GroupId:o.value.Data.GroupId,SrcName:o.value.Data.SrcName,Disabled:o.value.Data.Disabled,OrderBy:o.value.Data.OrderBy,SrcId:o.value.Data.SrcId,DstCIDR:o.value.Data.DstCIDR,DstPort:o.value.Data.DstPort,Protocol:o.value.Data.Protocol,Action:o.value.Data.Action,Remark:o.value.Data.Remark}},rules:{SrcId:[{required:!0,message:"required",trigger:"blur"}],DstCIDR:[{type:"string",required:!0,message:"required",trigger:"blur",pattern:/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}(\/([0-9]|([1-2][0-9])|(3[0-2])))?)$|^0$|^\*$/}],DstPort:[{type:"string",required:!0,message:"required",trigger:"blur",pattern:/^((\d+)(?:,(\d+))*)$|^((\d+)(?:\-(\d+))*)$|^0$|^\*$/}]},protocols:[{label:"TCP",value:1},{label:"UDP",value:2}],actions:[{label:l("firewall.actionAllow"),value:1},{label:l("firewall.actionDeny"),value:2}]});(0,t.wB)((()=>r.show),(e=>{e||setTimeout((()=>{a("update:modelValue",e)}),300)}));const d=(0,g.KR)(null),n=()=>{d.value.validate((e=>{if(!e)return;const t=JSON.parse(JSON.stringify(r.ruleForm));t.Data.Protocol=r.protocolChecks.reduce(((e,a)=>e|a),0),F(t).then((()=>{V.nk.success(l("common.oper")),r.show=!1,a("success")})).catch((()=>{V.nk.error(l("common.operFail"))}))}))},s=()=>{const e=r.machineIds.List.find((e=>e.MachineId==r.ruleForm.Data.SrcId));e&&(r.ruleForm.Data.SrcName=e.MachineName)},i=e=>{r.machineIds.Request.Page=e,c()},u=e=>{r.machineIds.Request.Name=e,c()},c=()=>{r.loading=!0,(0,R.BS)(r.machineIds.Request).then((e=>{r.loading=!1,r.machineIds.Request=e.Request,r.machineIds.Count=e.Count,e.List.splice(0,0,{MachineId:"*",MachineName:"*"}),r.ruleForm.Data.SrcId&&0==e.List.filter((e=>e.MachineId==r.ruleForm.Data.SrcId)).length&&e.List.splice(1,0,{MachineId:r.ruleForm.Data.SrcId,MachineName:r.ruleForm.Data.SrcName}),r.machineIds.List=e.List})).catch((e=>{r.loading=!1}))};return{state:r,ruleFormRef:d,handleSave:n,handleMachineSearch:u,handleMachinePageChange:i,handleMachineChange:s}}},M=l(1241);const N=(0,M.A)(y,[["render",L],["__scopeId","data-v-49e775dd"]]);var x=N,U={props:["machineId","machineName"],components:{Add:x},setup(e,{emit:a}){const{t:l}=(0,_.s9)(),o=(0,w.B)(),r=(0,g.Kh)({loading:!0,search:{MachineId:e.machineId||o.value.config.Client.Id,Data:{Str:"",Disabled:-1,Protocol:3,Action:3}},protocols:[{label:l("firewall.protocolall"),value:3},{label:"TCP",value:1},{label:"UDP",value:2}],actions:[{label:l("firewall.actionall"),value:3},{label:l("firewall.actionAllow"),value:1},{label:l("firewall.actionDeny"),value:2}],states:[{label:l("firewall.disabledAll"),value:-1},{label:l("firewall.enabled"),value:0},{label:l("firewall.disabled"),value:1}],data:[],state:1,height:(0,g.EW)((()=>o.value.height-140)),showAdd:!1}),d=()=>{r.loading=!0,D(r.search).then((e=>{r.loading=!1,r.data=e.List,r.state=e.State})).catch((e=>{console.log(e),r.loading=!1}))},n=()=>{r.loading=!0,C({MachineId:r.search.MachineId,State:r.state}).then((()=>{r.loading=!1,V.nk.success(l("common.oper"))})).catch((e=>{r.loading=!1,console.log(e),V.nk.error(l("common.operFail"))}))},s=e=>{r.loading=!0,I({MachineId:r.search.MachineId,Id:e.Id}).then((()=>{d(),r.loading=!1})).catch((()=>{r.loading=!1}))},i=e=>{r.loading=!0,F({MachineId:r.search.MachineId,Data:e}).then((()=>{d(),r.loading=!1})).catch((()=>{r.loading=!1}))},u=(0,g.KR)({});(0,t.Gt)("add",u);const c=e=>{u.value={MachineId:r.search.MachineId,Data:e||{Id:"",GroupId:o.value.config.Client.Group.Id,SrcName:"",Disabled:!1,OrderBy:0,SrcId:"",DstCIDR:"0.0.0.0/0",DstPort:"0",Protocol:3,Action:1,Remark:l("firewall.actionAllowAll")}},r.showAdd=!0},m=["","TCP","UDP"],h=e=>[m[1&e],m[2&e]].filter((e=>!!e)).join("/"),b=["","✔","✘"],p=e=>b[e],v=({row:e,rowIndex:a})=>`action-${e.Action}`;return(0,t.sV)((()=>{d()})),{state:r,loadData:d,tableRowClassName:v,handleSetState:n,handleAdd:c,handleDel:s,handleShowProtocol:h,handleShowAction:p,handleDsiabled:i}}};const W=(0,M.A)(U,[["render",f],["__scopeId","data-v-3294acdd"]]);var z=W}}]);